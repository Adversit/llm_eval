# LLM评估平台 - 系统架构与数据流程图

## 1. 整体系统架构图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                            LLM 评估平台前端                                  │
│                          (React + TypeScript + Ant Design)                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                               │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐            │
│  │  评估模块前端    │  │  问答模块前端    │  │  FLMM模块前端   │            │
│  │  - Workflow.tsx │  │  - Process.tsx  │  │  - Create.tsx   │            │
│  │  - Analysis.tsx │  │  - Status.tsx   │  │  - Projects.tsx │            │
│  │                 │  │  - Results.tsx  │  │  - Analysis.tsx │            │
│  └────────┬────────┘  └────────┬────────┘  └────────┬────────┘            │
│           │                     │                     │                      │
└───────────┼─────────────────────┼─────────────────────┼──────────────────────┘
            │                     │                     │
            │ HTTP/JSON API       │                     │
            │                     │                     │
┌───────────┼─────────────────────┼─────────────────────┼──────────────────────┐
│           │                     │                     │                      │
│  ┌────────▼────────┐   ┌───────▼────────┐   ┌───────▼────────┐            │
│  │ /api/eval/*     │   │ /api/qa/*      │   │ /api/flmm/*    │            │
│  │ evaluation.py   │   │ qa.py          │   │ flmm.py        │            │
│  └────────┬────────┘   └───────┬────────┘   └───────┬────────┘            │
│           │                     │                     │                      │
│           │                     │                     │                      │
│  ┌────────▼────────────────────────────────────────────────────┐           │
│  │              FastAPI 应用主入口 (main.py)                    │           │
│  │  - CORS中间件配置                                             │           │
│  │  - 路由注册与管理                                             │           │
│  │  - 健康检查与监控                                             │           │
│  └────────┬──────────────────────────────────────────────────┘           │
│           │                                                                 │
│           │                     后端服务层                                 │
│           │          (Python + FastAPI + Uvicorn)                         │
└───────────┼─────────────────────────────────────────────────────────────────┘
            │
            │
┌───────────┼─────────────────────────────────────────────────────────────────┐
│           │                  核心业务逻辑层                                  │
├───────────┼─────────────────────────────────────────────────────────────────┤
│           │                                                                 │
│  ┌────────▼──────────────┐  ┌──────────────────┐  ┌───────────────────┐  │
│  │  LLM_EVAL 核心模块    │  │  QA处理模块       │  │  FLMM处理模块     │  │
│  │  - Stage1Evaluator   │  │  - QA解析器       │  │  - FLMM解析器     │  │
│  │  - Stage2Evaluator   │  │  - 文档处理器      │  │  - 问卷生成器     │  │
│  │  - ResultProcessor   │  │  - 问答对提取器    │  │  - 代码生成器     │  │
│  │  - ReportGenerator   │  │                  │  │  - 结果分析器     │  │
│  └───────────────────────┘  └──────────────────┘  └───────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
            │
            │
┌───────────┼─────────────────────────────────────────────────────────────────┐
│           │                  数据持久化层                                    │
├───────────┼─────────────────────────────────────────────────────────────────┤
│           │                                                                 │
│  ┌────────▼──────────┐  ┌─────────────────┐  ┌──────────────────┐        │
│  │  评估数据存储      │  │  问答数据存储    │  │  FLMM数据存储     │        │
│  │  data/evaluation/ │  │  data/qa/       │  │  data/flmm/      │        │
│  │  - tasks.json     │  │  - tasks.json   │  │  - projects.json │        │
│  │  - uploads/       │  │  - documents/   │  │  - documents/    │        │
│  │  - results/       │  │  - qa_pairs/    │  │  - results/      │        │
│  └───────────────────┘  └─────────────────┘  └──────────────────┘        │
│                                                                             │
│  ┌───────────────────────────────────────────────────────────┐            │
│  │  LLM_EVAL 数据目录                                         │            │
│  │  LLM_EVAL/data/                                           │            │
│  │  - {model_name}{timestamp}/                               │            │
│  │    - test_data/        (测试数据)                         │            │
│  │    - {file_name}/      (单文件结果)                       │            │
│  │    - multi_file/       (多文件汇总)                       │            │
│  │    - 结果分析/          (分析报告)                         │            │
│  └───────────────────────────────────────────────────────────┘            │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
            │
            │
┌───────────▼─────────────────────────────────────────────────────────────────┐
│                         外部服务与模型层                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌───────────────────┐  ┌───────────────────┐  ┌────────────────────┐     │
│  │  测试模型 API      │  │  评估模型 API      │  │  文档处理服务       │     │
│  │  - OpenAI         │  │  - DeepSeek       │  │  - python-docx     │     │
│  │  - Claude         │  │  - Qwen           │  │  - pandas          │     │
│  │  - Qwen           │  │  - SiliconFlow    │  │  - openpyxl        │     │
│  │  - 自定义模型      │  │                   │  │                    │     │
│  └───────────────────┘  └───────────────────┘  └────────────────────┘     │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

## 2. 模块一：双阶段评估系统架构

```
┌──────────────────────────────────────────────────────────────────────┐
│                      双阶段评估系统架构                               │
└──────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────┐
│                        前端层 (Frontend)                              │
├──────────────────────────────────────────────────────────────────────┤
│  Workflow.tsx (评估流程)              Analysis.tsx (结果分析)         │
│  - 模型选择                            - 任务选择                     │
│  - 文件上传                            - 结果可视化                   │
│  - 参数配置                            - 图表展示                     │
│  - 进度监控                            - 报告下载                     │
└────────────┬────────────────────────────────────┬────────────────────┘
             │ POST /api/eval/create              │ GET /api/eval/results
             │ GET /api/eval/task/{id}            │ GET /api/eval/downloads
             │                                    │
┌────────────▼────────────────────────────────────▼────────────────────┐
│                       API层 (evaluation.py)                           │
├──────────────────────────────────────────────────────────────────────┤
│  /upload          - 文件上传                                          │
│  /create          - 创建评估任务                                      │
│  /task/{id}       - 获取任务状态                                      │
│  /results/{id}    - 获取评估结果                                      │
│  /downloads/{id}  - 下载报告                                          │
│  /models          - 获取模型列表                                      │
│  /files           - 列出服务器文件                                    │
│  /stats           - 统计信息                                          │
└────────────┬─────────────────────────────────────────────────────────┘
             │
             │ BackgroundTasks: process_evaluation_task()
             │
┌────────────▼─────────────────────────────────────────────────────────┐
│                    业务逻辑层 (LLM_EVAL)                              │
├──────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  Stage1Evaluator (第一阶段评估器)                            │   │
│  │  - load_data()           加载测试数据                        │   │
│  │  - run_llm_test()        LLM推理测试                        │   │
│  │  - evaluate_responses()  评估LLM响应                        │   │
│  │  - analyze_results()     分析评估结果                       │   │
│  │  - save_retest_data()    保存需重测数据                     │   │
│  └─────────────────────────────────────────────────────────────┘   │
│           │                                                           │
│           │ 生成 stage1_to_stage2_data.csv                           │
│           │                                                           │
│  ┌────────▼────────────────────────────────────────────────────┐   │
│  │  Stage2Evaluator (第二阶段评估器)                            │   │
│  │  - load_data()           加载重测数据                        │   │
│  │  - run_llm_test()        LLM推理测试 (带参考内容)           │   │
│  │  - evaluate_responses()  评估LLM响应                        │   │
│  │  - analyze_results()     分析评估结果                       │   │
│  │  - classify_errors()     错误分类                           │   │
│  └─────────────────────────────────────────────────────────────┘   │
│           │                                                           │
│           │ 生成 stage2 评估结果                                      │
│           │                                                           │
│  ┌────────▼────────────────────────────────────────────────────┐   │
│  │  ResultProcessor (结果处理器)                                │   │
│  │  - process_single_file_results()   单文件结果汇总           │   │
│  │  - process_multi_file_results()    多文件结果汇总           │   │
│  │  - create_round_analysis()         轮次分析                 │   │
│  │  - generate_final_analysis()       生成最终分析             │   │
│  └─────────────────────────────────────────────────────────────┘   │
│           │                                                           │
│           │ 生成 {file_name}_analysis.json                           │
│           │                                                           │
│  ┌────────▼────────────────────────────────────────────────────┐   │
│  │  ReportGenerator (报告生成器)                                │   │
│  │  - generate_html_report()    HTML报告生成                   │   │
│  │  - create_download_package() ZIP打包下载                    │   │
│  │  - export_json()             JSON导出                       │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                       │
└───────────────────────────────────────────────────────────────────────┘
             │
             │
┌────────────▼─────────────────────────────────────────────────────────┐
│                    数据持久化层                                       │
├──────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  data/evaluation/                                                    │
│  ├── tasks.json              (任务状态存储)                          │
│  ├── uploads/                (上传文件缓存)                          │
│  └── results/                (评估结果存储)                          │
│                                                                       │
│  LLM_EVAL/data/{model_name}{timestamp}/                             │
│  ├── test_data/              (原始测试数据)                          │
│  ├── {file_name}/                                                    │
│  │   ├── stage1_test_results_round1.csv                             │
│  │   ├── stage1_eval_results_round1.csv                             │
│  │   ├── stage1_to_stage2_data.csv                                  │
│  │   ├── stage2_test_results.csv                                    │
│  │   ├── stage2_eval_results.csv                                    │
│  │   ├── round1_analysis.json                                       │
│  │   └── {file_name}_analysis.json                                  │
│  ├── multi_file/             (多文件汇总分析)                       │
│  └── 结果分析/                (可视化分析报告)                       │
│                                                                       │
└───────────────────────────────────────────────────────────────────────┘
```

## 3. 模块二：问答对管理系统架构

```
┌──────────────────────────────────────────────────────────────────────┐
│                      问答对管理系统架构                               │
└──────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────┐
│                        前端层 (Frontend)                              │
├──────────────────────────────────────────────────────────────────────┤
│  Process.tsx (处理流程)    Status.tsx (状态监控)   Results.tsx (结果)│
│  - 文档上传                - 任务列表              - 问答对展示       │
│  - 参数配置                - 进度查看              - 数据筛选         │
│  - 任务创建                - 状态刷新              - 数据导出         │
└────────────┬────────────────────┬──────────────────────┬─────────────┘
             │                    │                      │
             │ POST /api/qa/upload│ GET /api/qa/tasks   │ GET /api/qa/results
             │ POST /api/qa/process                      │ GET /api/qa/export
             │                    │                      │
┌────────────▼────────────────────▼──────────────────────▼─────────────┐
│                       API层 (qa.py)                                   │
├──────────────────────────────────────────────────────────────────────┤
│  /upload       - 文档上传                                             │
│  /process      - 创建QA提取任务                                       │
│  /tasks        - 获取所有任务                                         │
│  /task/{id}    - 获取任务详情                                         │
│  /results      - 获取所有问答对                                       │
│  /export       - 导出问答对数据                                       │
│  /delete/{id}  - 删除任务                                             │
└────────────┬─────────────────────────────────────────────────────────┘
             │
             │ BackgroundTasks: process_qa_extraction()
             │
┌────────────▼─────────────────────────────────────────────────────────┐
│                    业务逻辑层 (QA Processing)                         │
├──────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  文档解析模块                                                 │   │
│  │  - extract_text_from_docx()   Word文档解析                   │   │
│  │  - extract_text_from_pdf()    PDF文档解析                    │   │
│  │  - extract_text_from_txt()    文本文件解析                   │   │
│  │  - clean_text()               文本清洗                       │   │
│  └─────────────────────────────────────────────────────────────┘   │
│           │                                                           │
│           │ 提取纯文本内容                                            │
│           │                                                           │
│  ┌────────▼────────────────────────────────────────────────────┐   │
│  │  LLM问答对提取器                                              │   │
│  │  - 构建提取提示词                                             │   │
│  │  - 调用LLM API                                               │   │
│  │  - 解析LLM响应                                               │   │
│  │  - 验证问答对格式                                             │   │
│  └─────────────────────────────────────────────────────────────┘   │
│           │                                                           │
│           │ 生成问答对列表                                            │
│           │                                                           │
│  ┌────────▼────────────────────────────────────────────────────┐   │
│  │  问答对后处理                                                 │   │
│  │  - 去重处理                                                   │   │
│  │  - 质量检查                                                   │   │
│  │  - 数据清洗                                                   │   │
│  │  - 格式标准化                                                 │   │
│  └─────────────────────────────────────────────────────────────┘   │
│           │                                                           │
│           │ 保存到存储                                                │
│           │                                                           │
│  ┌────────▼────────────────────────────────────────────────────┐   │
│  │  数据导出模块                                                 │   │
│  │  - export_to_excel()   Excel导出                             │   │
│  │  - export_to_json()    JSON导出                              │   │
│  │  - export_to_csv()     CSV导出                               │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                       │
└───────────────────────────────────────────────────────────────────────┘
             │
             │
┌────────────▼─────────────────────────────────────────────────────────┐
│                    数据持久化层                                       │
├──────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  data/qa/                                                            │
│  ├── tasks.json              (任务状态存储)                          │
│  ├── documents/              (上传文档存储)                          │
│  │   └── {task_id}/                                                 │
│  │       ├── document1.docx                                         │
│  │       └── document2.pdf                                          │
│  └── qa_pairs/               (问答对数据存储)                        │
│      └── {task_id}/                                                  │
│          ├── qa_pairs.json    (JSON格式)                            │
│          └── qa_pairs.xlsx    (Excel格式)                           │
│                                                                       │
└───────────────────────────────────────────────────────────────────────┘
```

## 4. 模块三：FLMM问卷平台架构

```
┌──────────────────────────────────────────────────────────────────────┐
│                      FLMM问卷平台架构                                 │
└──────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────┐
│                        前端层 (Frontend)                              │
├──────────────────────────────────────────────────────────────────────┤
│  Create.tsx (创建项目)    Projects.tsx (项目管理)  Analysis.tsx (分析)│
│  - 项目信息填写            - 项目列表展示           - 数据统计         │
│  - 文档上传                - 项目状态查看           - 图表展示         │
│  - 问卷配置                - 文件下载               - 结果导出         │
│  - 问卷生成                - 代码生成               - 可视化分析       │
└────────────┬────────────────────┬──────────────────────┬─────────────┘
             │                    │                      │
             │ POST /api/flmm/upload                     │ GET /api/flmm/analysis
             │ POST /api/flmm/generate│ GET /api/flmm/projects
             │                    │                      │
┌────────────▼────────────────────▼──────────────────────▼─────────────┐
│                       API层 (flmm.py)                                 │
├──────────────────────────────────────────────────────────────────────┤
│  /upload            - 文档上传                                        │
│  /generate          - 生成问卷与代码                                  │
│  /projects          - 获取项目列表                                    │
│  /project/{id}      - 获取项目详情                                    │
│  /download          - 下载问卷文件                                    │
│  /download/code     - 下载Python代码                                  │
│  /analysis/{id}     - 获取分析结果                                    │
│  /delete/{id}       - 删除项目                                        │
└────────────┬─────────────────────────────────────────────────────────┘
             │
             │ BackgroundTasks: generate_questionnaire_task()
             │
┌────────────▼─────────────────────────────────────────────────────────┐
│                    业务逻辑层 (FLMM Processing)                       │
├──────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  文档解析模块 (flmm_parser.py)                               │   │
│  │  - parse_docx()          Word文档解析                        │   │
│  │  - extract_questions()   提取问题                            │   │
│  │  - extract_options()     提取选项                            │   │
│  │  - extract_logic()       提取逻辑规则                        │   │
│  └─────────────────────────────────────────────────────────────┘   │
│           │                                                           │
│           │ 结构化问卷数据                                            │
│           │                                                           │
│  ┌────────▼────────────────────────────────────────────────────┐   │
│  │  问卷生成器                                                   │   │
│  │  - generate_docx()       生成Word问卷                        │   │
│  │  - apply_formatting()    应用格式                            │   │
│  │  - add_logic_rules()     添加逻辑规则                        │   │
│  │  - validate_structure()  验证结构                            │   │
│  └─────────────────────────────────────────────────────────────┘   │
│           │                                                           │
│           │ 生成问卷文件                                              │
│           │                                                           │
│  ┌────────▼────────────────────────────────────────────────────┐   │
│  │  Python代码生成器                                             │   │
│  │  - generate_data_structure()   生成数据结构                  │   │
│  │  - generate_validation()       生成验证逻辑                  │   │
│  │  - generate_analysis_code()    生成分析代码                  │   │
│  │  - add_visualization()         添加可视化代码                │   │
│  └─────────────────────────────────────────────────────────────┘   │
│           │                                                           │
│           │ 生成Python脚本                                            │
│           │                                                           │
│  ┌────────▼────────────────────────────────────────────────────┐   │
│  │  结果分析模块 (flmm_analyzer.py)                             │   │
│  │  - analyze_responses()      分析问卷响应                     │   │
│  │  - calculate_statistics()   计算统计指标                     │   │
│  │  - generate_charts()        生成图表                         │   │
│  │  - export_results()         导出分析结果                     │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                       │
└───────────────────────────────────────────────────────────────────────┘
             │
             │
┌────────────▼─────────────────────────────────────────────────────────┐
│                    数据持久化层                                       │
├──────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  data/flmm/                                                          │
│  ├── projects.json           (项目状态存储)                          │
│  ├── documents/              (上传文档存储)                          │
│  │   └── {project_id}/                                              │
│  │       └── source_document.docx                                   │
│  └── results/                (生成结果存储)                          │
│      └── {project_id}/                                               │
│          ├── questionnaire.docx    (问卷文件)                       │
│          ├── analysis_code.py      (Python代码)                     │
│          ├── metadata.json         (元数据)                         │
│          └── analysis_results.json (分析结果)                       │
│                                                                       │
└───────────────────────────────────────────────────────────────────────┘
```

## 5. 数据流程图

### 5.1 双阶段评估系统数据流

```
┌─────────────────────────────────────────────────────────────────────┐
│                   双阶段评估系统数据流程                             │
└─────────────────────────────────────────────────────────────────────┘

用户操作                     数据流转                        系统处理
────────                     ────────                        ────────

[选择模型]
    │
    ├──────────────────────> [模型配置]
    │                           │
[上传文件]                      │
    │                           │
    ├──────────────────────> [文件数据]
    │                           │
[配置参数]                      │
    │                           │
    └──────────────────────> [评估参数]
                                │
                                ▼
                        ┌───────────────┐
                        │  创建评估任务  │
                        └───────┬───────┘
                                │
                                │ task_id
                                ▼
                        ┌───────────────┐
                        │  加载测试数据  │
                        └───────┬───────┘
                                │
                                │ data_list
                                ▼
                        ┌───────────────┐
                        │  Stage1测试    │ ──> LLM API调用
                        │  (问题推理)    │ <── LLM响应
                        └───────┬───────┘
                                │
                                │ test_results.csv
                                ▼
                        ┌───────────────┐
                        │  Stage1评估    │ ──> 评估模型API
                        │  (打分)        │ <── 评分结果
                        └───────┬───────┘
                                │
                                │ eval_results.csv
                                ▼
                        ┌───────────────┐
                        │  结果分析      │
                        │  (阈值判断)    │
                        └───────┬───────┘
                                │
                    ┌───────────┴───────────┐
                    │                       │
              [达标问题]              [未达标问题]
                    │                       │
                    │                       ▼
                    │               ┌───────────────┐
                    │               │  生成重测数据  │
                    │               │  stage1_to_   │
                    │               │  stage2.csv   │
                    │               └───────┬───────┘
                    │                       │
                    │                       ▼
                    │               ┌───────────────┐
                    │               │  Stage2测试    │ ──> LLM API
                    │               │  (带参考内容)  │ <── LLM响应
                    │               └───────┬───────┘
                    │                       │
                    │                       │ stage2_test_results.csv
                    │                       ▼
                    │               ┌───────────────┐
                    │               │  Stage2评估    │ ──> 评估模型
                    │               │  (错误分类)    │ <── 分类结果
                    │               └───────┬───────┘
                    │                       │
                    │                       │ stage2_eval_results.csv
                    └───────────┬───────────┘
                                │
                                ▼
                        ┌───────────────┐
                        │  结果汇总      │
                        │  - 单文件分析  │
                        │  - 多文件汇总  │
                        │  - 统计计算    │
                        └───────┬───────┘
                                │
                                │ analysis.json
                                ▼
                        ┌───────────────┐
                        │  生成报告      │
                        │  - HTML报告    │
                        │  - JSON数据    │
                        │  - ZIP打包     │
                        └───────┬───────┘
                                │
                                │ 下载链接
                                ▼
[查看结果] <───────────── [返回给用户]
[下载报告]
```

### 5.2 问答对管理系统数据流

```
┌─────────────────────────────────────────────────────────────────────┐
│                   问答对管理系统数据流程                             │
└─────────────────────────────────────────────────────────────────────┘

用户操作                     数据流转                        系统处理
────────                     ────────                        ────────

[上传文档]
  (Word/PDF/TXT)
    │
    └──────────────────────> [文档文件]
                                │
                                ▼
                        ┌───────────────┐
                        │  文档解析      │
                        │  - 读取内容    │
                        │  - 提取文本    │
                        │  - 文本清洗    │
                        └───────┬───────┘
                                │
                                │ 纯文本内容
                                ▼
                        ┌───────────────┐
                        │  文本分块      │
                        │  - 按段落分割  │
                        │  - 控制长度    │
                        │  - 保留上下文  │
                        └───────┬───────┘
                                │
                                │ 文本块列表
                                ▼
                        ┌───────────────┐
                        │  构建提示词    │
                        │  - 添加指令    │
                        │  - 插入文本块  │
                        │  - 格式约束    │
                        └───────┬───────┘
                                │
                                │ 完整提示词
                                ▼
                        ┌───────────────┐
                        │  调用LLM API   │ ──> LLM服务
                        │  (问答对提取)  │ <── LLM响应
                        └───────┬───────┘
                                │
                                │ 原始LLM输出
                                ▼
                        ┌───────────────┐
                        │  响应解析      │
                        │  - 提取JSON    │
                        │  - 格式验证    │
                        │  - 错误处理    │
                        └───────┬───────┘
                                │
                                │ 问答对列表
                                ▼
                        ┌───────────────┐
                        │  数据后处理    │
                        │  - 去重        │
                        │  - 质量检查    │
                        │  - 格式标准化  │
                        └───────┬───────┘
                                │
                                │ 清洗后的问答对
                                ▼
                        ┌───────────────┐
                        │  数据存储      │
                        │  - 保存JSON    │
                        │  - 生成Excel   │
                        │  - 更新状态    │
                        └───────┬───────┘
                                │
                                │ 存储路径
                                ▼
[查看结果] <───────────── [返回给用户]
[导出数据]                  - 问答对列表
                            - 统计信息
                            - 下载链接
```

### 5.3 FLMM问卷平台数据流

```
┌─────────────────────────────────────────────────────────────────────┐
│                   FLMM问卷平台数据流程                               │
└─────────────────────────────────────────────────────────────────────┘

用户操作                     数据流转                        系统处理
────────                     ────────                        ────────

[上传问卷文档]
  (Word格式)
    │
    └──────────────────────> [文档文件]
                                │
                                ▼
                        ┌───────────────┐
                        │  文档解析      │
                        │  (flmm_parser) │
                        └───────┬───────┘
                                │
                ┌───────────────┼───────────────┐
                │               │               │
                ▼               ▼               ▼
        ┌──────────┐    ┌──────────┐    ┌──────────┐
        │ 提取问题  │    │ 提取选项  │    │ 提取逻辑  │
        └─────┬────┘    └─────┬────┘    └─────┬────┘
              │               │               │
              └───────────────┼───────────────┘
                              │
                              │ 结构化数据
                              ▼
                        ┌───────────────┐
                        │  数据验证      │
                        │  - 完整性检查  │
                        │  - 格式验证    │
                        │  - 逻辑校验    │
                        └───────┬───────┘
                                │
                    ┌───────────┴───────────┐
                    │                       │
                    ▼                       ▼
            ┌───────────────┐      ┌───────────────┐
            │  生成问卷文档  │      │  生成Python   │
            │  (docx)       │      │  分析代码     │
            └───────┬───────┘      └───────┬───────┘
                    │                       │
                    │ questionnaire.docx    │ analysis_code.py
                    │                       │
                    └───────────┬───────────┘
                                │
                                ▼
                        ┌───────────────┐
                        │  元数据生成    │
                        │  - 问卷信息    │
                        │  - 项目配置    │
                        │  - 生成时间    │
                        └───────┬───────┘
                                │
                                │ metadata.json
                                ▼
                        ┌───────────────┐
                        │  数据存储      │
                        │  - 保存问卷    │
                        │  - 保存代码    │
                        │  - 保存元数据  │
                        └───────┬───────┘
                                │
                                │ 项目ID
                                ▼
[查看项目] <───────────── [返回给用户]
[下载文件]                  - 问卷文件
[运行分析]                  - Python代码
                            - 项目信息

                            │
                            │ (用户填写问卷后)
                            │
                            ▼
                        ┌───────────────┐
                        │  上传问卷数据  │
                        │  (填写结果)    │
                        └───────┬───────┘
                                │
                                │ 响应数据
                                ▼
                        ┌───────────────┐
                        │  运行分析代码  │
                        │  (Python脚本)  │
                        └───────┬───────┘
                                │
                                │ 分析结果
                                ▼
                        ┌───────────────┐
                        │  数据可视化    │
                        │  - 统计图表    │
                        │  - 交叉分析    │
                        │  - 趋势分析    │
                        └───────┬───────┘
                                │
                                │ 可视化结果
                                ▼
[查看分析] <───────────── [返回给用户]
[导出报告]                  - 统计结果
                            - 图表数据
                            - 分析报告
```

## 6. 关键技术栈

### 前端技术栈
- **框架**: React 18 + TypeScript
- **UI组件**: Ant Design 5.x
- **状态管理**: Zustand + React Query
- **路由**: React Router v6
- **图表**: Recharts
- **动画**: Framer Motion
- **构建工具**: Vite

### 后端技术栈
- **框架**: FastAPI + Python 3.8+
- **Web服务器**: Uvicorn
- **异步处理**: BackgroundTasks
- **数据持久化**: JSON文件存储
- **文档处理**: python-docx, pandas, openpyxl
- **LLM集成**: OpenAI SDK, 自定义API客户端

### LLM_EVAL核心技术
- **评估框架**: 自研双阶段评估系统
- **数据处理**: pandas, numpy
- **文件管理**: 单例模式文件管理器
- **报告生成**: HTML模板引擎, ZIP打包

## 7. 系统特点

1. **模块化设计**: 三大模块相互独立，可单独部署和扩展
2. **异步处理**: 使用FastAPI的BackgroundTasks处理长时间任务
3. **实时进度**: 前端轮询+后端状态更新实现进度实时展示
4. **数据持久化**: JSON文件存储，易于迁移和备份
5. **灵活配置**: 支持多种模型、多轮评估、自定义阈值
6. **完整工作流**: 从数据上传到结果分析的完整闭环
7. **可视化展示**: 丰富的图表和统计分析功能
